# bmad 小程序端

研学商城小程序 - 用户端应用

## 技术栈

- 微信小程序原生开发
- JavaScript ES6+
- WXSS 样式
- WeChat API

## 功能模块

### 已实现功能

#### 用户端功能
- ✅ 微信授权登录
- ✅ 浏览研学产品
- ✅ 搜索和筛选产品
- ✅ 查看产品详情
- ✅ 产品收藏
- ✅ 订单管理
- ✅ 在线下单
- ✅ 微信支付
- ✅ 个人中心
- ✅ 联系客服

#### 页面列表

1. **首页 (pages/index)**
   - 轮播图展示
   - 快捷分类导航
   - 热门推荐产品
   - 最新上架产品
   - 搜索功能

2. **产品列表 (pages/products)**
   - 产品搜索
   - 分类筛选
   - 价格排序
   - 销量排序
   - 综合筛选
   - 分页加载

3. **产品详情 (pages/product)**
   - 图片轮播
   - 产品信息展示
   - 行程安排
   - 费用说明
   - 注意事项
   - 收藏功能
   - 立即预订

4. **订单列表 (pages/orders)**
   - 订单状态筛选
   - 订单搜索
   - 订单操作（支付、取消、确认）
   - 分页加载

5. **订单详情 (pages/order)**
   - 订单状态展示
   - 产品信息
   - 订单信息
   - 参与人信息
   - 订单操作

6. **个人中心 (pages/profile)**
   - 用户信息展示
   - 订单快捷入口
   - 我的收藏
   - 收货地址
   - 联系客服
   - 关于我们
   - 退出登录

7. **登录页 (pages/login)**
   - 微信一键登录
   - 用户协议
   - 隐私政策

## 项目结构

```
miniprogram/
├── pages/              # 页面目录
│   ├── index/         # 首页
│   │   ├── index.wxml
│   │   ├── index.wxss
│   │   ├── index.js
│   │   └── index.json
│   ├── products/      # 产品列表
│   ├── product/       # 产品详情
│   ├── orders/        # 订单列表
│   ├── order/         # 订单详情
│   ├── profile/       # 个人中心
│   └── login/         # 登录页
├── utils/             # 工具函数
│   ├── request.js    # 网络请求封装
│   └── auth.js       # 认证相关
├── images/            # 图片资源
├── app.js            # 小程序入口
├── app.json          # 全局配置
├── app.wxss          # 全局样式
├── sitemap.json      # 搜索配置
├── project.config.json # 项目配置
└── package.json      # 依赖配置
```

## 核心功能说明

### 网络请求封装 (utils/request.js)

- 统一的请求拦截器
- 自动添加 Authorization 头
- Token 过期自动刷新
- 错误统一处理
- 加载状态管理

### 认证模块 (utils/auth.js)

- 微信授权登录
- 用户信息管理
- 登录状态检查
- 手机号获取
- 退出登录

### 数据流转

```
用户操作 → 页面事件 → Service层 → API请求 → 后端处理
                ↓
          状态更新 → 页面渲染
```

## 接口对接

所有接口与后端 API 对接：
- **基础 URL**: `http://localhost:3000/api/v1` (开发环境)
- **认证方式**: JWT Token
- **数据格式**: JSON

### 主要接口

| 功能 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 微信登录 | POST | /auth/wx/login | 微信授权登录 |
| 产品列表 | GET | /products | 获取产品列表 |
| 产品详情 | GET | /products/:id | 获取产品详情 |
| 创建订单 | POST | /orders | 创建订单 |
| 订单列表 | GET | /orders | 获取订单列表 |
| 订单详情 | GET | /orders/:id | 获取订单详情 |
| 支付订单 | POST | /orders/:id/pay | 发起支付 |
| 取消订单 | PUT | /orders/:id/cancel | 取消订单 |

## 开发指南

### 环境准备

1. 下载并安装微信开发者工具
2. 注册微信小程序账号，获取 AppID
3. 配置服务器域名白名单

### 本地开发

1. 修改 `project.config.json` 中的 `appid`
2. 修改 `app.js` 中的 `apiBaseUrl` 为实际后端地址
3. 使用微信开发者工具打开项目目录
4. 点击"编译"按钮运行

### 调试技巧

1. **开启调试模式**: 微信开发者工具 -> 调试器 -> Console
2. **查看网络请求**: 调试器 -> Network
3. **查看存储**: 调试器 -> Storage
4. **查看页面性能**: 调试器 -> Performance

### 注意事项

1. **域名配置**: 开发时可在开发者工具中勾选"不校验合法域名"
2. **用户信息**: 获取用户信息需要用户授权
3. **支付功能**: 需要配置微信支付商户号
4. **图片资源**: 建议使用 CDN 存储图片

## 待开发功能

### 近期规划
- ⏳ 订单确认页
- ⏳ 退款申请
- ⏳ 收货地址管理
- ⏳ 我的收藏页面
- ⏳ 优惠券功能
- ⏳ 评价功能

### 长期规划
- ⏳ 积分系统
- ⏳ 会员体系
- ⏳ 分享裂变
- ⏳ 消息推送
- ⏳ 直播功能

## 常见问题

### Q1: 登录失败？
- 检查后端服务是否启动
- 检查 API 地址配置是否正确
- 确认微信 AppID 配置正确

### Q2: 支付调起失败？
- 确认已配置微信支付
- 检查商户号配置
- 确认支付参数正确

### Q3: 图片加载失败？
- 检查图片 URL 是否正确
- 确认图片域名已配置白名单
- 检查网络连接

## 部署上线

1. 在微信开发者工具中点击"上传"
2. 登录微信公众平台提交审核
3. 审核通过后发布上线

## 版本历史

- **v1.0.0** (2026-01-13)
  - 初始版本发布
  - 完成基础功能开发

## 技术支持

如有问题，请联系开发团队。

---

**最后更新**: 2026-01-13
**版本**: 1.0.0

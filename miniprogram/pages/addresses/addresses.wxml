<!--pages/addresses/addresses.wxml-->
<view class="container">
  <!-- 地址列表 -->
  <view class="address-list" wx:if="{{addresses.length > 0}}">
    <view
      class="address-item"
      wx:for="{{addresses}}"
      wx:key="id"
    >
      <view class="address-info" bindtap="selectAddress" data-id="{{item.id}}">
        <view class="address-header">
          <text class="contact-name">{{item.name}}</text>
          <text class="contact-phone">{{item.phone}}</text>
          <view class="default-badge" wx:if="{{item.isDefault}}">默认</view>
        </view>
        <view class="address-detail">
          <text class="region">{{item.province}} {{item.city}} {{item.district}}</text>
          <text class="detail">{{item.detail}}</text>
        </view>
      </view>

      <view class="address-actions">
        <button
          class="btn-action"
          bindtap="setDefault"
          data-id="{{item.id}}"
          wx:if="{{!item.isDefault}}"
        >
          设为默认
        </button>
        <button
          class="btn-action"
          bindtap="editAddress"
          data-address="{{item}}"
        >
          编辑
        </button>
        <button
          class="btn-action btn-delete"
          bindtap="deleteAddress"
          data-id="{{item.id}}"
        >
          删除
        </button>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty" wx:else>
    <image class="empty-icon" src="/images/icon_address.png" mode="aspectFit"></image>
    <text class="empty-title">暂无收货地址</text>
    <text class="empty-desc">添加收货地址，方便接收合同票据</text>
    <button class="btn-add" bindtap="addAddress">添加地址</button>
  </view>

  <!-- 底部添加按钮 -->
  <view class="bottom-bar" wx:if="{{addresses.length > 0}}">
    <button class="btn-add-new" bindtap="addAddress">新增地址</button>
  </view>
</view>

<!-- 地址编辑弹窗 -->
<view class="address-modal {{showModal ? 'show' : ''}}" bindtap="closeModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">{{isEdit ? '编辑地址' : '新增地址'}}</text>
      <text class="modal-close" bindtap="closeModal">✕</text>
    </view>

    <view class="modal-body">
      <view class="form-item">
        <text class="form-label">联系人</text>
        <input
          class="form-input"
          placeholder="请输入联系人姓名"
          value="{{formData.name}}"
          bindinput="onInputChange"
          data-field="name"
        />
      </view>

      <view class="form-item">
        <text class="form-label">联系电话</text>
        <input
          class="form-input"
          type="number"
          placeholder="请输入联系电话"
          value="{{formData.phone}}"
          bindinput="onInputChange"
          data-field="phone"
        />
      </view>

      <view class="form-item">
        <text class="form-label">所在地区</text>
        <picker
          mode="region"
          value="{{formData.region}}"
          bindchange="onRegionChange"
        >
          <view class="picker-view">
            <text class="{{formData.region.length > 0 ? '' : 'placeholder'}}">
              {{formData.region.length > 0 ? formData.region.join(' ') : '请选择省市区'}}
            </text>
            <text class="arrow">›</text>
          </view>
        </picker>
      </view>

      <view class="form-item">
        <text class="form-label">详细地址</text>
        <textarea
          class="form-textarea"
          placeholder="请输入详细地址，如街道、楼栋号、门牌号等"
          value="{{formData.detail}}"
          bindinput="onInputChange"
          data-field="detail"
          maxlength="200"
        />
      </view>

      <view class="form-item checkbox-item">
        <checkbox-group bindchange="onDefaultChange">
          <label class="checkbox-label">
            <checkbox value="isDefault" checked="{{formData.isDefault}}" color="#07c160" />
            <text>设为默认地址</text>
          </label>
        </checkbox-group>
      </view>
    </view>

    <view class="modal-footer">
      <button class="btn-cancel" bindtap="closeModal">取消</button>
      <button class="btn-confirm" bindtap="saveAddress">保存</button>
    </view>
  </view>
</view>

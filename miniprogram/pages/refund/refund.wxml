<!--pages/refund/refund.wxml-->
<view class="container" wx:if="{{order}}">
  <!-- 订单信息 -->
  <view class="card">
    <view class="card-header">
      <text class="card-title">订单信息</text>
    </view>
    <view class="order-info">
      <view class="info-row">
        <text class="info-label">订单号</text>
        <text class="info-value">{{order.orderNo}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">产品</text>
        <text class="info-value">{{order.product.title}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">订单金额</text>
        <text class="info-value price">¥{{order.totalAmount}}</text>
      </view>
      <view class="info-row" wx:if="{{order.paidAt}}">
        <text class="info-label">支付时间</text>
        <text class="info-value">{{order.paidAt}}</text>
      </view>
    </view>
  </view>

  <!-- 退款原因 -->
  <view class="card">
    <view class="card-header">
      <text class="card-title">退款原因</text>
      <text class="required">*</text>
    </view>
    <view class="reason-list">
      <view
        class="reason-item {{selectedReason === item ? 'active' : ''}}"
        wx:for="{{reasons}}"
        wx:key="*this"
        bindtap="selectReason"
        data-reason="{{item}}"
      >
        <text class="reason-text">{{item}}</text>
        <view class="reason-check" wx:if="{{selectedReason === item}}">
          <text>✓</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 退款说明 -->
  <view class="card">
    <view class="card-header">
      <text class="card-title">退款说明</text>
      <text class="optional">选填</text>
    </view>
    <view class="form-section">
      <textarea
        class="form-textarea"
        placeholder="请详细描述退款原因，以便我们更快处理"
        value="{{description}}"
        bindinput="onDescriptionInput"
        maxlength="500"
      />
      <view class="textarea-counter">{{description.length}}/500</view>
    </view>
  </view>

  <!-- 退款金额 -->
  <view class="card">
    <view class="card-header">
      <text class="card-title">退款金额</text>
    </view>
    <view class="refund-amount">
      <text class="amount-label">退款金额</text>
      <text class="amount-value">¥{{order.totalAmount}}</text>
    </view>
    <view class="refund-tip">
      <text>退款将原路返回到您的支付账户</text>
    </view>
  </view>

  <!-- 退款须知 -->
  <view class="notice">
    <text class="notice-title">退款须知</text>
    <view class="notice-content">
      <text class="notice-item">1. 退款将在1-3个工作日内原路返回</text>
      <text class="notice-item">2. 退款后如有疑问，请联系客服</text>
      <text class="notice-item">3. 活动产品可能不支持退款，请以产品说明为准</text>
      <text class="notice-item">4. 恶意申请退款可能影响后续购买</text>
    </view>
  </view>

  <!-- 提交按钮 -->
  <view class="bottom-bar">
    <button
      class="btn-submit"
      disabled="{{!selectedReason || submitting}}"
      bindtap="submitRefund"
    >
      {{submitting ? '提交中...' : '提交退款申请'}}
    </button>
  </view>
</view>

<!-- 加载中 -->
<view class="loading-container" wx:if="{{loading}}">
  <text>加载中...</text>
</view>

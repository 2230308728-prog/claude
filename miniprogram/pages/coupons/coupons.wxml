<!--pages/coupons/coupons.wxml-->
<view class="container">
  <!-- Tab 切换 -->
  <view class="tabs">
    <view
      class="tab-item {{currentTab === 'available' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="available"
    >
      可使用 ({{availableCount}})
    </view>
    <view
      class="tab-item {{currentTab === 'used' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="used"
    >
      已使用
    </view>
    <view
      class="tab-item {{currentTab === 'expired' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="expired"
    >
      已过期
    </view>
  </view>

  <!-- 优惠券列表 -->
  <view class="coupons-list" wx:if="{{coupons.length > 0}}">
    <view
      class="coupon-item {{item.status === 'EXPIRED' || item.status === 'USED' ? 'disabled' : ''}}"
      wx:for="{{coupons}}"
      wx:key="id"
    >
      <!-- 左侧金额区域 -->
      <view class="coupon-left">
        <view class="coupon-amount">
          <text class="amount-symbol">¥</text>
          <text class="amount-value" wx:if="{{coupon.type === 'AMOUNT'}}">{{item.coupon.value}}</text>
          <text class="amount-value" wx:else>{{item.coupon.value}}</text>
          <text class="amount-unit" wx:if="{{coupon.type === 'PERCENT'}}">折</text>
        </view>
        <view class="coupon-condition" wx:if="{{item.coupon.minAmount}}">
          满{{item.coupon.minAmount}}元可用
        </view>
        <view class="coupon-condition" wx:else>无门槛</view>
      </view>

      <!-- 中间虚线 -->
      <view class="coupon-divider">
        <view class="divider-top"></view>
        <view class="divider-dashed"></view>
        <view class="divider-bottom"></view>
      </view>

      <!-- 右侧信息区域 -->
      <view class="coupon-right">
        <view class="coupon-name">{{item.coupon.name}}</view>
        <view class="coupon-desc" wx:if="{{item.coupon.description}}">
          {{item.coupon.description}}
        </view>
        <view class="coupon-time">
          有效期至 {{item.expiresAt | formatDate}}
        </view>

        <!-- 操作按钮 -->
        <view class="coupon-actions">
          <button
            class="btn-use"
            wx:if="{{item.status === 'AVAILABLE'}}"
            bindtap="useCoupon"
            data-id="{{item.id}}"
            data-coupon-id="{{item.couponId}}"
          >
            立即使用
          </button>
          <view class="status-tag status-used" wx:elif="{{item.status === 'USED'}}">已使用</view>
          <view class="status-tag status-expired" wx:else>已过期</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty" wx:else>
    <image class="empty-icon" src="/images/icon_coupon.png" mode="aspectFit"></image>
    <text class="empty-title">暂无优惠券</text>
    <text class="empty-desc">快去领取优惠券吧</text>
    <button class="btn-go-shop" bindtap="goToShop">去逛逛</button>
  </view>
</view>

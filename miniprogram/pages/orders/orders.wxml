<!--pages/orders/orders.wxml-->
<view class="container">
  <!-- è®¢å•çŠ¶æ€æ ‡ç­¾ -->
  <view class="status-tabs">
    <view
      class="tab-item {{currentTab === '' ? 'active' : ''}}"
      bindtap="switchTab"
      data-status=""
    >
      å…¨éƒ¨
    </view>
    <view
      class="tab-item {{currentTab === 'PENDING' ? 'active' : ''}}"
      bindtap="switchTab"
      data-status="PENDING"
    >
      å¾…æ”¯ä»˜
    </view>
    <view
      class="tab-item {{currentTab === 'PAID' ? 'active' : ''}}"
      bindtap="switchTab"
      data-status="PAID"
    >
      å·²æ”¯ä»˜
    </view>
    <view
      class="tab-item {{currentTab === 'COMPLETED' ? 'active' : ''}}"
      bindtap="switchTab"
      data-status="COMPLETED"
    >
      å·²å®Œæˆ
    </view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <view class="order-list" wx:if="{{orders.length > 0}}">
    <view
      class="order-item"
      wx:for="{{orders}}"
      wx:key="id"
      bindtap="goToOrder"
      data-id="{{item.id}}"
    >
      <!-- è®¢å•å¤´éƒ¨ -->
      <view class="order-header">
        <text class="order-no">è®¢å•å·ï¼š{{item.orderNo}}</text>
        <text class="order-status status-{{item.status}}">{{item.statusText}}</text>
      </view>

      <!-- äº§å“ä¿¡æ¯ -->
      <view class="order-product">
        <image class="product-image" src="{{item.product.coverImage}}" mode="aspectFill"></image>
        <view class="product-info">
          <text class="product-title">{{item.product.title}}</text>
          <view class="product-meta">
            <text class="product-date" wx:if="{{item.travelDate}}">
              å‡ºè¡Œæ—¥æœŸï¼š{{item.travelDate}}
            </text>
          </view>
          <view class="product-participant">
            <text>å‚ä¸äººï¼š{{item.participantName}}</text>
            <text class="age">ï¼ˆ{{item.participantAge}}å²ï¼‰</text>
          </view>
        </view>
        <view class="product-price">
          <text class="price">Â¥{{item.totalAmount}}</text>
        </view>
      </view>

      <!-- è®¢å•åº•éƒ¨ -->
      <view class="order-footer">
        <text class="order-time">{{item.createdAt}}</text>
        <view class="order-actions">
          <button
            class="btn-action btn-cancel"
            wx:if="{{item.status === 'PENDING'}}"
            catchtap="cancelOrder"
            data-id="{{item.id}}"
          >
            å–æ¶ˆè®¢å•
          </button>
          <button
            class="btn-action btn-pay"
            wx:if="{{item.status === 'PENDING'}}"
            catchtap="payOrder"
            data-id="{{item.id}}"
          >
            å»æ”¯ä»˜
          </button>
          <button
            class="btn-action btn-confirm"
            wx:if="{{item.status === 'COMPLETED'}}"
            catchtap="confirmOrder"
            data-id="{{item.id}}"
          >
            ç¡®è®¤å®Œæˆ
          </button>
          <button
            class="btn-action btn-detail"
            catchtap="goToOrder"
            data-id="{{item.id}}"
          >
            æŸ¥çœ‹è¯¦æƒ…
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty" wx:else>
    <text class="empty-icon">ğŸ“‹</text>
    <text class="empty-text">æš‚æ— è®¢å•</text>
    <button class="btn-go-shop" bindtap="goToShop">å»é€›é€›</button>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore && orders.length > 0}}">
    <text wx:if="{{!loading}}">ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
    <text wx:else>åŠ è½½ä¸­...</text>
  </view>

  <!-- æ²¡æœ‰æ›´å¤š -->
  <view class="no-more" wx:if="{{!hasMore && orders.length > 0}}">
    <text>æ²¡æœ‰æ›´å¤šäº†</text>
  </view>
</view>
